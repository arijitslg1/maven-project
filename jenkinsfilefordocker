node{ 
    stage ('scm checkout') { 
       git 'https://github.com/arijitslg1/maven-project/'
       sh "git branch -r" 
       sh "git checkout master"
    }
    
    stage ('package stage') { 
       sh label: '', script: 'mvn clean package' 
    }
    
    stage ('docker image build') { 
       sh 'docker build -t arijitslg1/prakash-app:1.0.0 .' 
    }
    
    stage ('Push Docker image to DockerHub') { 
      withCredentials([string(credentialsId: 'dockerhubaccount', variable: 'dockerhubaccount')]) { 
        sh "docker login -u arijitslg1 -p ${dockerhubaccount}" 
      } 
        sh 'docker push arijitslg1/docker-tomcat-app:1.0.0' 
      }
      
    stage ('Deploy to Dev') { 
       def dockerRun = 'docker run -d -p 9000:8080 --name my-tomcat-app pkw0301/prakash-app:1.0.0' 
       sshagent(['deploy-to-dev-docker']) { 
         sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.39.210 ${dockerRun}" 
       } 
    }
}
